<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // 將工作表轉換為 JSON 以過濾空行
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // 過濾掉完全空的行（所有單元格均為空、null 或 undefined）
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // 使用啟發式方法找到標題行，忽略填充單元格數少於下一行的行
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // 後備方案
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // 將過濾後的 JSON 轉回 CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // 從過濾後的陣列創建新工作表
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽獎器</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <button id="addItemBtn">新增項目</button>
            <div id="addItemModal" class="modal">
                <div class="modal-content">
                    <h2>新增項目</h2>
                    <label>名稱: <input type="text" id="itemName"></label>
                    <label>比重: <input type="number" id="itemWeight" min="1"></label>
                    <div class="modal-buttons">
                        <button id="cancelAdd">取消</button>
                        <button id="confirmAdd">確認新增</button>
                    </div>
                </div>
            </div>
            <div id="itemList"></div>
            <button id="clearAllItems">全部清除</button>
        </div>
        <div class="center-panel">
            <button id="startDraw">開始抽獎</button>
            <div id="animationArea">
                <div class="indicator"></div>
                <svg class="wheel" width="400" height="400" viewBox="0 0 400 400"></svg>
            </div>
            <div id="winnerList">
                <h2>中獎列表</h2>
                <ul id="winners"></ul>
                <button id="clearWinners">清除中獎列表</button>
            </div>
        </div>
        <div class="right-panel">
            <h2>抽獎規則</h2>
            <label><input type="checkbox" id="noRepeat"> 不重複抽獎</label>
            <label><input type="checkbox" id="finitePool"> 有限獎池</label>
        </div>
    </div>
    <script src="script.js"></script>
    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                var filteredData = jsonData.filter(row => row.some(filledCell));
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
    </script>
</body>
</html>
